<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Bi√™n b·∫£n x√°c nh·∫≠n</title>
  <script src="jquery-3.7.1.js"></script>
  <link href="bootstrap-5.3.8-dist\css\bootstrap.min.css" rel="stylesheet"/>
  <style>
    body {
      font-family: "Times New Roman", serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      width: 900px;
      margin: 20px auto;
      background: #fff;
      padding: 30px 40px;
      border: 1px solid #ccc;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 22px;
    }
    .code {
      text-align: left;
    }
    .row {
      margin: 8px 0;
    }
    input[type="text"] {
      width: 250px;
      border: none;
      border-bottom: 1px dotted #000;
      outline: none;
      background: transparent;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    table, th, td {
      border: 1px solid #000;
    }
    th, td {
      padding: 6px;
      text-align: center;
    }
    textarea {
      width: 100%;
      height: 70px;
      border: 1px solid #000;
      resize: vertical;
    }
    .logo {
      float: right;
    }
    
    /* N√∫t xu·∫•t Word */
    .export-btn-container {
      text-align: center;
      margin: 20px 0;
    }
    
    .btn-export {
      background-color: #2e7d32;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .table-textarea {
      width: 100%;
      height: 100%;
      border: none !important;
      background: transparent;
      resize: none;
      font-family: "Times New Roman", serif;
      font-size: 14px;
      text-align: center;
      padding: 5px;
    }
    
    .loading {
      display: none;
      text-align: center;
      margin: 10px 0;
      color: #2e7d32;
      font-weight: bold;
    }
    
    .footer-info {
      border-top: 1px solid #ccc;
      padding-top: 15px;
      margin-top: 20px;
    }
    
    #previewImage {
      max-height: 80px;
      width: auto;
    }
  </style>
</head>
<body>
  <div class="export-btn-container">
    <button class="btn-export" onclick="exportToWord()">
      üìÑ Xu·∫•t sang Word
    </button>
    <div class="loading" id="loadingIndicator">ƒêang xu·∫•t file...</div>
  </div>

  <div class="container" id="exportContent">
    
    <!-- Logo section -->
    <div class="row">
      <div style="float: right;">
        <!-- H√¨nh ·∫£nh t·ª´ web -->
        <img id="logoImage" src="IMG_2143.JPG" alt="Logo" style="max-height: 80px; width: auto;">
        <!-- N·∫øu kh√¥ng c√≥ ·∫£nh, hi·ªÉn th·ªã placeholder -->
        <div id="logoPlaceholder" style="display:none; width: 150px; height: 60px; border: 1px solid #ccc; text-align: center; line-height: 60px;">
          [LOGO]
        </div>
      </div>
      
      <h1>BI√äN B·∫¢N X√ÅC NH·∫¨N</h1>
      <div class="code">S·ªë: <input type="text" id="soBB" style="width:50px" value=""/> /BM.26/NSIP-KYT</div>
      <div class="row">H√¥m nay, ng√†y <input type="text" id="ngay" style="width:40px" value=""/> th√°ng <input type="text" id="thang" style="width:40px" value=""/> nƒÉm <input type="text" id="nam" style="width:60px" value=""/></div>
    </div>

    <div class="row">Ch√∫ng t√¥i g·ªìm:</div>
    <div class="row">
      <div class="col-6">
        <ol type="1">
          <li>√îng/B√†: <input type="text" id="ten1" value=""/></li>
          <li>√îng/B√†: <input type="text" id="ten2" value=""/></li>
          <li>√îng/B√†: <input type="text" id="ten3" value=""/></li>
          <li>√îng/B√†: <input type="text" id="ten4" value=""/></li>
        </ol>
      </div>
      <div class="col-6">
        <ul style="list-style-type: none; padding-left: 0;">
          <li>Ch·ª©c v·ª•: <input type="text" id="chucvu1" value=""/></li>
          <li>Ch·ª©c v·ª•: <input type="text" id="chucvu2" value=""/></li>
          <li>Ch·ª©c v·ª•: <input type="text" id="chucvu3" value=""/></li>
          <li>Ch·ª©c v·ª•: <input type="text" id="chucvu4" value=""/></li>
        </ul>
      </div>
    </div>
    
    <div class="code">
      Ch√∫ng t√¥i s·∫Ω s·ª≠ d·ª•ng ph∆∞∆°ng ti·ªán: 
      <input type="text" id="phuongTien1" style="width:200px" value=""/> 
      ƒë·ªÉ th·ª±c hi·ªán t·ªãnh c√¢n, ki·ªÉm tra 
      <input type="text" id="soDiem" style="width:30px" value=""/> 
      ƒëi·ªÉm tr√™n 1 b√†n c√¢n cho 
      <input type="text" id="soBanCan" style="width:30px" value=""/> 
      b√†n c√¢n c·ªßa C·∫£ng, k·∫øt qu·∫£ ƒë∆∞·ª£c ghi nh·∫≠n nh∆∞ sau:
    </div>
    
    <div class="row">
      <div class="col-6" style="font-style:italic; text-align: left;">B·∫£ng 1:</div>
      <div class="col-6" style="font-style:italic; text-align: right;">(ƒê∆°n v·ªã: Kg)</div>
    </div>
    
    <table id="bang1">
      <tr>
        <th>ƒêi·ªÉm c√¢n</th>
        <th>B√†n c√¢n 01</th>
        <th>B√†n c√¢n 02</th>
        <th>B√†n c√¢n 03</th>
        <th>B√†n c√¢n 04</th>
        <th>B√†n c√¢n 05</th>
        <th>B√†n c√¢n 06</th>
      </tr>
      <!-- T·∫°o 6 h√†ng cho b·∫£ng 1 -->
      <script>
        for(let i = 1; i <= 6; i++) {
          document.write(`
            <tr>
              <td>ƒêi·ªÉm ${i}</td>
              <td><textarea class="table-textarea" id="b1_d${i}_c1"></textarea></td>
              <td><textarea class="table-textarea" id="b1_d${i}_c2"></textarea></td>
              <td><textarea class="table-textarea" id="b1_d${i}_c3"></textarea></td>
              <td><textarea class="table-textarea" id="b1_d${i}_c4"></textarea></td>
              <td><textarea class="table-textarea" id="b1_d${i}_c5"></textarea></td>
              <td><textarea class="table-textarea" id="b1_d${i}_c6"></textarea></td>
            </tr>
          `);
        }
      </script>
    </table>
    
    <div class="code">
      V√† s·ª≠ d·ª•ng ph∆∞∆°ng ti·ªán 
      <input type="text" id="phuongTien2" style="width:200px" value=""/> 
      ƒë·ªÉ th·ª±c hi·ªán t·ªãnh c√¢n t·ªïng th·ªÉ 
      <input type="text" id="soBanCan2" style="width:30px" value=""/> 
      b√†n c√¢n, k·∫øt qu·∫£ ghi nh·∫≠n nh∆∞ sau:
    </div>
    
    <div class="row">
      <div class="col-6" style="font-style:italic; text-align: left;">B·∫£ng 2:</div>
      <div class="col-6" style="font-style:italic; text-align: right;">(ƒê∆°n v·ªã: Kg)</div>
    </div>
    
    <table id="bang2">
      <tr>
        <th>B√†n c√¢n 01</th>
        <th>B√†n c√¢n 02</th>
        <th>B√†n c√¢n 03</th>
        <th>B√†n c√¢n 04</th>
        <th>B√†n c√¢n 05</th>
        <th>B√†n c√¢n 06</th>
      </tr>
      <tr>
        <td><textarea class="table-textarea" id="b2_c1"></textarea></td>
        <td><textarea class="table-textarea" id="b2_c2"></textarea></td>
        <td><textarea class="table-textarea" id="b2_c3"></textarea></td>
        <td><textarea class="table-textarea" id="b2_c4"></textarea></td>
        <td><textarea class="table-textarea" id="b2_c5"></textarea></td>
        <td><textarea class="table-textarea" id="b2_c6"></textarea></td>
      </tr>
    </table>

    <div class="row"><b>K·∫øt lu·∫≠n:</b></div>
    <textarea id="ketLuan" rows="3"></textarea>
    
    <div class="row"><b>Ph∆∞∆°ng √°n x·ª≠ l√Ω:</b></div>
    <textarea id="phuongAn" rows="3"></textarea>
    
    <div class="row"><b>X√°c nh·∫≠n:</b></div>
    <div class="row">
      <div class="col-3" style="text-align: center; height:100px;"><b>BP.IT</b></div>
      <div class="col-3" style="text-align: center;height:100px;"><b>X∆∞·ªüng c∆° ƒëi·ªán</b></div>
      <div class="col-3" style="text-align: center;height:100px;"><b>T·ªï b√†n c√¢n</b></div>
      <div class="col-3" style="text-align: center;height:100px;"><b>P.K·ªπ thu·∫≠t</b></div>
    </div>
    
    <div class="footer-info">
      <div class="row">
        <div class="col-6" style="text-align: left;font-size: 13px;">
          <p><b>C·∫¢NG QU·ªêC T·∫æ NGHI S∆†N</b></p>
          <p><b>ƒê·ªãa ch·ªâ:</b> TDP H√† T√¢n, Ph∆∞·ªùng Nghi S∆°n, t·ªânh Thanh H√≥a</p>
        </div>
        <div class="col-6" style="text-align: left;font-size: 13px;">
          <p><b>W</b> <a href="https://vasgroup.vn/">www.vasgroup.vn</a></p>
          <p><b>T  + 84 2373 613 938  F  + 84 2373 613 938</b></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // H√†m chuy·ªÉn ƒë·ªïi h√¨nh ·∫£nh sang base64
    function getImageBase64(imageElement) {
      return new Promise((resolve, reject) => {
        // Ki·ªÉm tra xem ·∫£nh c√≥ t·ªìn t·∫°i kh√¥ng
        if (!imageElement || !imageElement.src) {
          resolve(null);
          return;
        }
        
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        // X·ª≠ l√Ω CORS n·∫øu ·∫£nh t·ª´ domain kh√°c
        img.crossOrigin = 'anonymous';
        
        img.onload = function() {
          try {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            
            // Chuy·ªÉn ƒë·ªïi sang base64
            const base64String = canvas.toDataURL('image/png');
            resolve(base64String);
          } catch (error) {
            console.error('L·ªói khi chuy·ªÉn ƒë·ªïi ·∫£nh:', error);
            resolve(null);
          }
        };
        
        img.onerror = function() {
          console.warn('Kh√¥ng th·ªÉ t·∫£i ·∫£nh, s·ª≠ d·ª•ng placeholder');
          resolve(null);
        };
        
        img.src = imageElement.src;
        
        // N·∫øu ·∫£nh ƒë√£ ƒë∆∞·ª£c t·∫£i tr∆∞·ªõc ƒë√≥
        if (imageElement.complete) {
          img.src = imageElement.src;
        }
      });
    }

    async function exportToWord() {
      // Hi·ªÉn th·ªã loading
      document.getElementById('loadingIndicator').style.display = 'block';
      
      try {
        // L·∫•y h√¨nh ·∫£nh v√† chuy·ªÉn ƒë·ªïi sang base64
        const logoImage = document.getElementById('logoImage');
        let logoBase64 = null;
        
        // Th·ª≠ chuy·ªÉn ƒë·ªïi ·∫£nh sang base64
        if (logoImage && logoImage.src) {
          logoBase64 = await getImageBase64(logoImage);
        }
        
        // Thu th·∫≠p d·ªØ li·ªáu t·ª´ form
        const data = {
          soBB: document.getElementById('soBB').value || '',
          ngay: document.getElementById('ngay').value || '',
          thang: document.getElementById('thang').value || '',
          nam: document.getElementById('nam').value || '',
          ten1: document.getElementById('ten1').value || '',
          ten2: document.getElementById('ten2').value || '',
          ten3: document.getElementById('ten3').value || '',
          ten4: document.getElementById('ten4').value || '',
          chucvu1: document.getElementById('chucvu1').value || '',
          chucvu2: document.getElementById('chucvu2').value || '',
          chucvu3: document.getElementById('chucvu3').value || '',
          chucvu4: document.getElementById('chucvu4').value || '',
          phuongTien1: document.getElementById('phuongTien1').value || '',
          soDiem: document.getElementById('soDiem').value || '',
          soBanCan: document.getElementById('soBanCan').value || '',
          phuongTien2: document.getElementById('phuongTien2').value || '',
          soBanCan2: document.getElementById('soBanCan2').value || '',
          ketLuan: document.getElementById('ketLuan').value || '',
          phuongAn: document.getElementById('phuongAn').value || ''
        };
        
        // T·∫°o n·ªôi dung HTML cho Word v·ªõi h√¨nh ·∫£nh
        const wordContent = `
          <html xmlns:v="urn:schemas-microsoft-com:vml"
                xmlns:o="urn:schemas-microsoft-com:office:office"
                xmlns:w="urn:schemas-microsoft-com:office:word"
                xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
                xmlns="http://www.w3.org/TR/REC-html40">
          <head>
              <meta charset="UTF-8">
              <title>Bi√™n b·∫£n x√°c nh·∫≠n</title>
              <xml>
                  <w:WordDocument>
                      <w:View>Print</w:View>
                      <w:Zoom>100</w:Zoom>
                      <w:DoNotOptimizeForBrowser/>
                  </w:WordDocument>
              </xml>
              <style>
                  body {
                      font-family: "Times New Roman", serif;
                      font-size: 13pt;
                      line-height: 1.5;
                      margin: 40pt;
                  }
                  h1 {
                      text-align: left;
                      font-size: 18pt;
                      margin-bottom: 10pt;
                  }
                  table {
                      width: 100%;
                      border-collapse: collapse;
                      margin: 15pt 0;
                  }
                  table, th, td {
                      border: 1px solid black;
                  }
                  th, td {
                      padding: 6pt;
                      text-align: center;
                      vertical-align: middle;
                  }
                  .logo-container {
                      float: right;
                      margin-bottom: 20pt;
                  }
                  .logo-container img {
                      max-height: 80pt;
                      width: auto;
                  }
                  .signature-area {
                      margin-top: 40pt;
                  }
                  .signature-box {
                      height: 80pt;
                      border-bottom: 1px solid #000;
                      text-align: center;
                      margin-bottom: 5pt;
                  }
                  .footer-info {
                      border-top: 1px solid #ccc;
                      padding-top: 15pt;
                      margin-top: 30pt;
                      font-size: 10pt;
                  }
                  .data-field {
                      border-bottom: 1px dotted #000;
                      min-width: 100pt;
                      display: inline-block;
                      padding: 0 5pt;
                  }
                  .content-box {
                      border: 1px solid #000;
                      padding: 10pt;
                      min-height: 50pt;
                      margin-bottom: 15pt;
                  }
              </style>
          </head>
          <body>
              <!-- Logo -->
              <div class="logo-container">
                  ${logoBase64 ? `<img src="${logoBase64}" alt="Logo" style="max-height: 80pt;">` : '<div style="width: 150pt; height: 60pt; border: 1px solid #ccc; text-align: center; line-height: 60pt;">LOGO</div>'}
              </div>
              
              <h1>BI√äN B·∫¢N X√ÅC NH·∫¨N</h1>
              
              <div>S·ªë: <span class="data-field">${data.soBB}</span>/BM.26/NSIP-KYT</div>
              
              <div>H√¥m nay, ng√†y <span class="data-field">${data.ngay}</span> th√°ng <span class="data-field">${data.thang}</span> nƒÉm <span class="data-field">${data.nam}</span></div>
              
              <div style="margin-top: 15pt;">Ch√∫ng t√¥i g·ªìm:</div>
              <div style="margin-bottom: 15pt;">
                  <table style="width: 100%; border: none;">
                      <tr>
                          <td style="width: 50%; vertical-align: top; border: none;">
                              <ol type="1">
                                  <li>√îng/B√†: <span class="data-field">${data.ten1}</span></li>
                                  <li>√îng/B√†: <span class="data-field">${data.ten2}</span></li>
                                  <li>√îng/B√†: <span class="data-field">${data.ten3}</span></li>
                                  <li>√îng/B√†: <span class="data-field">${data.ten4}</span></li>
                              </ol>
                          </td>
                          <td style="width: 50%; vertical-align: top; border: none;">
                              <ul style="list-style-type: none; padding-left: 0;">
                                  <li>Ch·ª©c v·ª•: <span class="data-field">${data.chucvu1}</span></li>
                                  <li>Ch·ª©c v·ª•: <span class="data-field">${data.chucvu2}</span></li>
                                  <li>Ch·ª©c v·ª•: <span class="data-field">${data.chucvu3}</span></li>
                                  <li>Ch·ª©c v·ª•: <span class="data-field">${data.chucvu4}</span></li>
                              </ul>
                          </td>
                      </tr>
                  </table>
              </div>
              
              <div>Ch√∫ng t√¥i s·∫Ω s·ª≠ d·ª•ng ph∆∞∆°ng ti·ªán: <span class="data-field">${data.phuongTien1}</span> ƒë·ªÉ th·ª±c hi·ªán t·ªãnh c√¢n, ki·ªÉm tra <span class="data-field">${data.soDiem}</span> ƒëi·ªÉm tr√™n 1 b√†n c√¢n cho <span class="data-field">${data.soBanCan}</span> b√†n c√¢n c·ªßa C·∫£ng, k·∫øt qu·∫£ ƒë∆∞·ª£c ghi nh·∫≠n nh∆∞ sau:</div>
              
              <div style="margin-top: 10pt;">
                  <table style="width: 100%; border: none;">
                      <tr>
                          <td style="width: 50%; text-align: left; font-style: italic; border: none;">B·∫£ng 1:</td>
                          <td style="width: 50%; text-align: right; font-style: italic; border: none;">(ƒê∆°n v·ªã: Kg)</td>
                      </tr>
                  </table>
              </div>
              
              ${generateTableHTML('bang1')}
              
              <div>V√† s·ª≠ d·ª•ng ph∆∞∆°ng ti·ªán <span class="data-field">${data.phuongTien2}</span> ƒë·ªÉ th·ª±c hi·ªán t·ªãnh c√¢n t·ªïng th·ªÉ <span class="data-field">${data.soBanCan2}</span> b√†n c√¢n, k·∫øt qu·∫£ ghi nh·∫≠n nh∆∞ sau:</div>
              
              <div style="margin-top: 10pt;">
                  <table style="width: 100%; border: none;">
                      <tr>
                          <td style="width: 50%; text-align: left; font-style: italic; border: none;">B·∫£ng 2:</td>
                          <td style="width: 50%; text-align: right; font-style: italic; border: none;">(ƒê∆°n v·ªã: Kg)</td>
                      </tr>
                  </table>
              </div>
              
              ${generateTableHTML('bang2')}
              
              <div style="margin-top: 15pt;"><b>K·∫øt lu·∫≠n:</b></div>
              <div class="content-box">${data.ketLuan || ''}</div>
              
              <div style="margin-top: 15pt;"><b>Ph∆∞∆°ng √°n x·ª≠ l√Ω:</b></div>
              <div class="content-box">${data.phuongAn || ''}</div>
              
              <div style="margin-top: 15pt;"><b>X√°c nh·∫≠n:</b></div>
              <div class="signature-area">
                  <table style="width: 100%; border: none;">
                      <tr>
                          <td style="width: 25%; text-align: center; border: none;">
                              <div class="signature-box"></div>
                              <b>BP.IT</b>
                          </td>
                          <td style="width: 25%; text-align: center; border: none;">
                              <div class="signature-box"></div>
                              <b>X∆∞·ªüng c∆° ƒëi·ªán</b>
                          </td>
                          <td style="width: 25%; text-align: center; border: none;">
                              <div class="signature-box"></div>
                              <b>T·ªï b√†n c√¢n</b>
                          </td>
                          <td style="width: 25%; text-align: center; border: none;">
                              <div class="signature-box"></div>
                              <b>P.K·ªπ thu·∫≠t</b>
                          </td>
                      </tr>
                  </table>
              </div>
              
              <div class="footer-info">
                  <table style="width: 100%; border: none;">
                      <tr>
                          <td style="width: 50%; vertical-align: top; border: none;">
                              <p><b>C·∫¢NG QU·ªêC T·∫æ NGHI S∆†N</b></p>
                              <p><b>ƒê·ªãa ch·ªâ:</b> TDP H√† T√¢n, Ph∆∞·ªùng Nghi S∆°n, t·ªânh Thanh H√≥a</p>
                          </td>
                          <td style="width: 50%; vertical-align: top; border: none;">
                              <p><b>W</b> www.vasgroup.vn</p>
                              <p><b>T  + 84 2373 613 938  F  + 84 2373 613 938</b></p>
                          </td>
                      </tr>
                  </table>
              </div>
          </body>
          </html>
        `;
        
        // T·∫°o Blob v√† t·∫£i xu·ªëng
        const blob = new Blob(['\ufeff', wordContent], {
          type: 'application/msword'
        });
        
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        
        // T·∫°o t√™n file v·ªõi ng√†y th√°ng
        const fileName = `Bien_ban_xac_nhan_${data.ngay}_${data.thang}_${data.nam}.doc`;
        a.download = fileName;
        
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert('ƒê√£ xu·∫•t file Word th√†nh c√¥ng!');
        
      } catch (error) {
        console.error('L·ªói khi xu·∫•t file:', error);
        alert('C√≥ l·ªói x·∫£y ra khi xu·∫•t file. Vui l√≤ng th·ª≠ l·∫°i.');
      } finally {
        // ·∫®n loading
        document.getElementById('loadingIndicator').style.display = 'none';
      }
    }
    
    // H√†m t·∫°o HTML cho b·∫£ng
    function generateTableHTML(tableId) {
      const table = document.getElementById(tableId);
      if (!table) return '';
      
      const tempTable = table.cloneNode(true);
      
      // Thay th·∫ø textarea b·∫±ng n·ªôi dung
      const textareas = tempTable.querySelectorAll('textarea');
      textareas.forEach(textarea => {
        const value = textarea.value || '';
        const div = document.createElement('div');
        div.textContent = value;
        div.style.minHeight = '40pt';
        div.style.padding = '3pt';
        textarea.parentNode.replaceChild(div, textarea);
      });
      
      return tempTable.outerHTML;
    }
    
    // T·ª± ƒë·ªông ƒëi·ªÅn ng√†y th√°ng
    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date();
      const ngayInput = document.getElementById('ngay');
      const thangInput = document.getElementById('thang');
      const namInput = document.getElementById('nam');
      
      if (!ngayInput.value) ngayInput.value = today.getDate();
      if (!thangInput.value) thangInput.value = today.getMonth() + 1;
      if (!namInput.value) namInput.value = today.getFullYear();
      
      // Ki·ªÉm tra ·∫£nh c√≥ load ƒë∆∞·ª£c kh√¥ng
      const logoImage = document.getElementById('logoImage');
      const logoPlaceholder = document.getElementById('logoPlaceholder');
      
      logoImage.onerror = function() {
        logoImage.style.display = 'none';
        logoPlaceholder.style.display = 'block';
      };
      
      logoImage.onload = function() {
        logoPlaceholder.style.display = 'none';
      };
      
      // Th√™m s·ª± ki·ªán Enter ƒë·ªÉ chuy·ªÉn focus
      const inputs = document.querySelectorAll('input[type="text"]');
      inputs.forEach((input, index) => {
        input.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            if (index < inputs.length - 1) {
              inputs[index + 1].focus();
            }
          }
        });
      });
    });
  </script>
</body>
</html>